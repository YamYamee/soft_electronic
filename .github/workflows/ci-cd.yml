name: Fast CI/CD

on:
  push:
    branches: [master]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: [self-hosted, runner]
    steps:
      - name: 체크아웃
        uses: actions/checkout@v4

      - name: 빠른 배포
        run: |
          echo "🚀 초고속 배포 시작"
          
          # Docker 빌드 (캐시 최대 활용)
          docker build -t posture-app:latest . || exit 1
          
          # 기존 컨테이너 정리 및 재시작
          docker-compose down 2>/dev/null || true
          docker-compose up -d
          
          # 간단한 헬스체크
          sleep 10
          curl -f http://localhost:8000/health || echo "헬스체크 실패했지만 계속 진행"
          
          echo "✅ 배포 완료! http://localhost:8000"
