name: Fast CI/CD

on:
  push:
    branches: [master]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: [self-hosted, runner]
    steps:
      - name: ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ë¹ ë¥¸ ë°°í¬
        run: |
          echo "ğŸš€ ì´ˆê³ ì† ë°°í¬ ì‹œì‘"
          
          # Docker ë¹Œë“œ (ìºì‹œ ìµœëŒ€ í™œìš©)
          docker build -t posture-app:latest . || exit 1
          
          # ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì •ë¦¬ ë° ì¬ì‹œì‘
          docker-compose down 2>/dev/null || true
          docker-compose up -d
          
          # ê°„ë‹¨í•œ í—¬ìŠ¤ì²´í¬
          sleep 10
          curl -f http://localhost:8000/health || echo "í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨í–ˆì§€ë§Œ ê³„ì† ì§„í–‰"
          
          echo "âœ… ë°°í¬ ì™„ë£Œ! http://localhost:8000"
